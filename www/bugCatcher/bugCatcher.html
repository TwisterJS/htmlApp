<!doctype html> 
<html lang="en"> 
<head> 
	<meta charset="UTF-8" />
	<title>PhaserGame</title>
	<script type="text/javascript" src="js/phaser.min.js"></script>
    <link href="style.css" rel="stylesheet">
<body>

<script type="text/javascript">
//Building Blocks
var game = new Phaser.Game(800, 600, Phaser.AUTO, 'midDiv', { preload: preload, create: create, update: update });
var stars;
var badStars;
var platforms;
var ground;


//Variables
var currentScore = 1;
var numRounds = 5;
var numLives = 3;
var currentSpeed = 100;

var tags = ["&lt;HTML&gt;", "&lt;/HTML&gt;", "&lt;HEAD&gt;", "&lt;/HEAD&gt;", "&lt;BODY&gt;", "&lt;/BODY&gt;", "&lt;P&gt;", "&lt;/P&gt;"];

/**Loads all of the parts of the game**/
function preload()
{
	//Load the World
	game.load.image('sky', 'assets/sky_stars.png');
	game.load.image('ground', 'assets/platform.png');
	
	//Load the targets
	game.load.image('img0', 'assets/html.c.png');
	game.load.image('img1', 'assets/html.png');
	game.load.image('img2', 'assets/head.c.png');
	game.load.image('img3', 'assets/head.png');
	game.load.image('img4', 'assets/body.c.png');
	game.load.image('img5', 'assets/body.png');
	game.load.image('img6', 'assets/p.c.png');
	game.load.image('img7', 'assets/p.png');
	
	//Load the character
	game.load.spritesheet('dude', 'assets/dude.png', 32, 48);
}


/**Create the game**/
function create()
{
	//Load Phaser
	game.physics.startSystem(Phaser.Physics.ARCADE);
	
	//Add the background
	game.add.sprite( 0, 0, 'sky');
	
	//Add a platform group and a ground. For now, this is out of sight,
	//but is useful for event handling
	platforms = game.add.group();
	platforms.enableBody = true;
	ground = platforms.create(0, game.world.height + 10, 'ground');
	ground.scale.setTo(2,2);
	ground.body.immovable = true;
	
	//Add the player
	player = game.add.sprite(400, game.world.height - 80, 'dude');
	game.physics.arcade.enable(player);
	
	//Give a little gravity
	player.body.gravity.y = 200;
	
	//Keep player on the screen
	player.body.collideWorldBounds = true;
	
	//Add some animations
	player.animations.add('left', [0], 10, true);
	player.animations.add('right', [7], 10, true);
	player.animations.add('hit', [2,7, 2,7, 2,7, 2,7, 2,7, 2,7, 4], 2, true);
	
	//add groups for targets
	stars = game.add.group();
	badStars = game.add.group();
	stars.enableBody = true;
	badStars.enableBody = true;
	
	//Create the targets
	makeStars(getNum());
}

/**This runs at each frame of the game**/
function update()
{
	//Listen for keypresses
	cursors = game.input.keyboard.createCursorKeys();
	
	//set velocity to 0
	player.body.velocity.x = 0;
	
	//Move!
	if(cursors.left.isDown)
	{
		player.body.velocity.x = -50 - currentSpeed;
		player.animations.play('left');
	}
	else if(cursors.right.isDown)
	{
		player.body.velocity.x = 50 + currentSpeed;
		player.animations.play('right');
	}
	else if(cursors.up.isDown)
	{
		player.body.velocity.y = -50 - currentSpeed;
	} 
	else if(cursors.down.isDown)
	{
		player.body.velocity.y = 50 + currentSpeed;
	}
	else
	{
		//If the player isn't moving, point him forward
		if(!player.animations.getAnimation('hit').isPlaying)
		{
			player.frame = 4;
		}
	}
	
	//Top display
	if(currentScore <= numRounds && numLives > 0)
	{
		display("Level: " + currentScore + " | Lives Remaining: " + numLives);
	}
	
	//Control various events.
	game.physics.arcade.overlap(player, stars, collectStar, null, this);
	game.physics.arcade.overlap(ground, stars, collectStar, null, this);
	game.physics.arcade.overlap(player, badStars, dieNow, null, this);
	
}

/**Function for when player gets point**/
function collectStar (player, star)
{
	//Remove the target from game (otherwise it will continue counting)
	star.kill();
	
	//Add one to the score
	currentScore++;
	
	//Remove all of the non-targets
	badStars.forEachAlive(killEmAll, this);
	
	//If there are more levels, keep going
	if(currentScore <= numRounds)
	{
		//Increase speed
		currentSpeed += 50;
		
		//Make the targets
		makeStars(getNum());
		
		//Add a life
		numLives++;
	}
	else
	{
		//Hey, you won!
		display("You Win!!!");
	}
	
}

/**Gets a whole number between 0 and 8**/
function getNum()
{
	return Math.round(Math.random() * 8);
}

/**Makes the target and a specific number of non-targets**/
function makeStars(tag)
{
	//Make target in random location above screen
	var goodStar = stars.create((Math.random() * 700) + 50, Math.random() * -5000, 'img' + tag);
	
	//Set velocity to make target fall
	goodStar.body.velocity.y = currentSpeed;
	
	//Print the request to catch the target
	request(tags[tag]);
	
	//Make all the non-targets
	for (var i = 0; i < 60; i++)
	{
		//Get a random number and verify that it is not the target
		var arrNum = 9;
		while (arrNum <=0 || arrNum >= 8 || arrNum == tag)
		{
			arrNum = getNum();
		}
		
		//Get a random number for the vertical off-screen location
		var loc = -5000 * Math.random();
		//Make sure that they all show up at the same place
		if(loc > -100)
		{
			loc = loc / Math.random();
		}
		
		//Create the non-targets
		var star = badStars.create((Math.random() * 700) + 50, loc, 'img' + arrNum);
		
		//Set their velocity
		star.body.velocity.y = currentSpeed;
	}
}

/**Remove from game everything in a specific group**/
function killEmAll(star)
{
	star.kill();
}

/**Player hits a non-target**/
function dieNow (player, star)
{
	star.kill();
	
	if(numLives <= 0)
	{
		//Kill everything
		badStars.forEachAlive(killEmAll, this);
		stars.forEachAlive(killEmAll, this);
		//Stop player movement
		player.body.velocity.x = 0;
		player.body.velocity.y = 0;
		player.body.gravity.x = 0;
		player.body.gravity.y = 0;
		
		//Play dead animation
		player.animations.play('hit', 5, false, true);
		//Play game over
		display("Game Over!");
	}
	numLives--;
}

/**Change text of top bar**/
function display(text)
{
	var topDiv = document.getElementById("topDiv");
	
		topDiv.innerHTML = "<p>" + text + "</p>";
}

/**Change text of lower bar**/
function request(tag)
{
	//Build the string using the tag
	var newString = "";
	if(tag.charAt(4) == '/')
	{
		newString = "What is the opening tag for " + tag;
	}
	else
	{
		newString = "What is the closing tag for " + tag;
	}
	
	//Add string to footer.
	var bottomDiv = document.getElementById("bottomDiv");
	bottomDiv.innerHTML = "<p>" + newString + "</p>";
}



</script>
<div id="midArea">
<div id="topDiv">

</div>

<div id="midDiv">
</div>


<div id="bottomDiv">
</div>
</div>
</body>
</html>